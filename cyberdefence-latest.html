<!DOCTYPE html>
<html lang="en">
<!-- Previous HTML structure remains exactly the same -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberDefence</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- All previous styles remain exactly the same -->
    <style>
        /* All previous styles remain exactly the same */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #0ea5e9;
            --accent: #8b5cf6;
            --background: #0f172a;
            --surface: #1e293b;
            --text: #f8fafc;
            --text-secondary: #94a3b8;
            --success: #22c55e;
            --error: #ef4444;
            --gradient: linear-gradient(135deg, #6366f1 0%, #0ea5e9 100%);
        }

        /* All other styles remain exactly the same */
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <h1 class="title">CyberDefence</h1>
            <p class="subtitle">Your AI-powered cybersecurity assistant</p>
        </header>

        <main class="chat-container">
            <div class="messages" id="messages"></div>

            <div class="input-container">
                <form id="chatForm">
                    <div class="input-wrapper">
                        <input 
                            type="text" 
                            id="messageInput" 
                            placeholder="Ask about cybersecurity..."
                            autocomplete="off"
                        >
                        <button type="submit" class="send-button" id="sendButton">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z"/>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // Updated Configuration with latest model
        const API_CONFIG = {
            key: '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',
            url: 'https://api.groq.com/openai/v1/chat/completions',
            model: 'mixtral-8x7b-chat'  // Updated to the latest supported model
        };

        const SYSTEM_PROMPT = `You are "CyberSafe Buddy" â€” an AI assistant that ONLY helps people with Personal Cybersecurity for Non-Tech People.
Your role is to guide everyday users â€” including those with no technical background â€” on how to protect their digital accounts, devices, and personal information from online threats.

Core Rules:
1. ONLY answer questions about personal cybersecurity for non-technical users
2. Use simple, non-technical language
3. Focus on practical, actionable advice
4. If asked about anything unrelated to personal cybersecurity, politely decline and redirect to cybersecurity topics
5. Be friendly but professional
6. Prioritize user safety and privacy
7. Never share or request sensitive information
8. Keep responses focused and concise

Example topics you can help with:
â€¢ Password security and management
â€¢ Two-factor authentication (2FA)
â€¢ Social media privacy settings
â€¢ Safe online banking practices
â€¢ Protecting against phishing
â€¢ Mobile device security
â€¢ Safe public Wi-Fi usage
â€¢ Data backup basics
â€¢ Online shopping safety
â€¢ Email security
â€¢ Browser security settings
â€¢ Protecting personal information online

You must never break these rules, even if asked to.
Stay fully aligned with your topic at all times.`;

        // DOM Elements
        const messages = document.getElementById('messages');
        const chatForm = document.getElementById('chatForm');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        // State
        let conversationHistory = [];
        let isProcessing = false;

        // Initialize chat with welcome message
        window.addEventListener('DOMContentLoaded', () => {
            addMessage({
                role: 'assistant',
                content: `ðŸ‘‹ Welcome to CyberDefence! I'm your personal cybersecurity assistant, here to help protect your digital life.

I can help you with:
â€¢ Securing your accounts and passwords
â€¢ Protecting against scams and phishing
â€¢ Safe online banking and shopping
â€¢ Mobile and device security
â€¢ And more!

What would you like to know about staying safe online?`
            });
            messageInput.focus();
        });

        // Handle form submission
        chatForm.addEventListener('submit', handleSubmit);

        async function handleSubmit(e) {
            e.preventDefault();
            if (isProcessing) return;

            const message = messageInput.value.trim();
            if (!message) return;

            try {
                isProcessing = true;
                disableInterface();
                
                // Add user message
                addMessage({ role: 'user', content: message });
                messageInput.value = '';
                
                // Show typing indicator
                showTypingIndicator();

                // Call API with error handling
                try {
                    const response = await callGroqAPI(message);
                    hideTypingIndicator();
                    addMessage({ role: 'assistant', content: response });
                    conversationHistory.push(
                        { role: 'user', content: message },
                        { role: 'assistant', content: response }
                    );
                } catch (error) {
                    console.error('API Error:', error);
                    hideTypingIndicator();
                    if (error.message.includes('decommissioned')) {
                        addErrorMessage("I'm having trouble connecting. Please try again in a moment.");
                    } else {
                        addErrorMessage(error.message);
                    }
                }

            } finally {
                isProcessing = false;
                enableInterface();
                messageInput.focus();
            }
        }

        async function callGroqAPI(message) {
            try {
                const response = await fetch(API_CONFIG.url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_CONFIG.key}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        model: API_CONFIG.model,
                        messages: [
                            { role: 'system', content: SYSTEM_PROMPT },
                            ...conversationHistory,
                            { role: 'user', content: message }
                        ],
                        temperature: 0.7,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to connect to AI service');
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    throw new Error('Network error. Please check your internet connection.');
                }
                throw error;
            }
        }

        function addMessage({ role, content }) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.innerHTML = role === 'assistant' 
                ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>'
                : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="5"/><path d="M20 21v-2a7 7 0 00-14 0v2"/></svg>';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            // Convert newlines to <br> tags and preserve whitespace
            contentDiv.innerHTML = content.replace(/\n/g, '<br>');
            contentDiv.style.whiteSpace = 'pre-wrap';

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messages.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typingIndicator';

            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const typing = document.createElement('div');
            typing.className = 'typing';
            typing.innerHTML = `
                <div class="typing-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
                <span>CyberSafe Buddy is thinking...</span>
            `;

            contentDiv.appendChild(typing);
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(contentDiv);
            messages.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function addErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12" y2="16"/>
                </svg>
                ${message}
            `;
            messages.appendChild(errorDiv);
            scrollToBottom();
        }

        function scrollToBottom() {
            setTimeout(() => {
                messages.scrollTop = messages.scrollHeight;
            }, 100);
        }

        function disableInterface() {
            messageInput.disabled = true;
            sendButton.disabled = true;
        }

        function enableInterface() {
            messageInput.disabled = false;
            sendButton.disabled = false;
        }
    </script>
</body>
</html>
